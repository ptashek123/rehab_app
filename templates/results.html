{% extends "base.html" %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥–±–æ—Ä–∞{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2 class="mb-4 text-primary">–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏–∏</h2>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞—Ü–∏–µ–Ω—Ç–µ -->
        <div class="card mb-4 border-primary">
            <div class="card-header bg-light">
                <h5 class="mb-0">üìã –î–∞–Ω–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-2">
                        <strong>–î–∏–∞–≥–Ω–æ–∑:</strong><br>
                        {{ patient_data.diagnosis }}
                    </div>
                    <div class="col-md-2">
                        <strong>–°—Ç–µ–ø–µ–Ω—å —Ç—è–∂–µ—Å—Ç–∏:</strong><br>
                        {{ patient_data.severity }}
                    </div>
                    <div class="col-md-2">
                        <strong>–í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞:</strong><br>
                        {{ patient_data.age_group }}
                    </div>
                    <div class="col-md-3">
                        <strong>–¶–µ–ª–∏ —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏–∏:</strong><br>
                        {% if patient_data.goals %}
                        {% for goal in patient_data.goals %}
                        {% if goal == 'walking' %}–•–æ–¥—å–±–∞
                        {% elif goal == 'mobility' %}–ü–æ–¥–≤–∏–∂–Ω–æ—Å—Ç—å
                        {% elif goal == 'pain_relief' %}–°–Ω—è—Ç–∏–µ –±–æ–ª–∏
                        {% elif goal == 'coordination' %}–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è
                        {% elif goal == 'psychological' %}–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è
                        {% elif goal == 'daily_activities' %}–ë—ã—Ç–æ–≤—ã–µ –Ω–∞–≤—ã–∫–∏
                        {% else %}{{ goal }}{% endif %}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                        {% else %}
                        –ù–µ —É–∫–∞–∑–∞–Ω—ã
                        {% endif %}
                    </div>
                    <div class="col-md-3">
                        <strong>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ–¥–≤–∏–∂–Ω–æ—Å—Ç–∏:</strong><br>
                        {{ patient_data.mobility_restrictions if patient_data.mobility_restrictions else '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}
                    </div>
                </div>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        {% if programs %}
        <h3 class="mb-3">–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º: {{ programs|length }}</h3>

        {% for program in programs %}
        <div class="card mb-4 program-card border shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center bg-light">
                <h4 class="mb-0 text-primary">{{ program.display_name }}</h4>
                <span
                    class="badge bg-{% if program.score >= 80 %}success{% elif program.score >= 60 %}warning{% else %}danger{% endif %} fs-6 p-2">
                    –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: {{ program.score }}%
                </span>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h5 class="text-secondary">üè• –ú–µ—Ç–æ–¥—ã —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏–∏:</h5>
                        <ul class="list-group">
                            {% for method in program.methods %}
                            <li class="list-group-item">{{ method }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h5 class="text-secondary">üë®‚Äç‚öïÔ∏è –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã:</h5>
                        <ul class="list-group">
                            {% for specialist in program.specialists %}
                            <li class="list-group-item">{{ specialist }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-4">
                        <strong>‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> {{ program.duration }} –¥–Ω–µ–π
                    </div>
                    <div class="col-md-4">
                        <strong>üìÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∞–Ω—Å–æ–≤:</strong> {{ program.session_count }}
                    </div>
                    <div class="col-md-4">
                        <strong>üë§ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤:</strong><br>
                        {{ program.matching_patients|join(', ') }}
                    </div>
                </div>

                <div class="text-center mt-3">
                    <a href="{{ url_for('program_detail', program_name=program.name) }}"
                        class="btn btn-outline-primary btn-sm">üìä –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –ø—Ä–æ–≥—Ä–∞–º–º–µ</a>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="alert alert-warning text-center">
            <h4>üòï –ü—Ä–æ–≥—Ä–∞–º–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏.</p>
        </div>
        {% endif %}

        <div class="text-center mt-4">
            <a href="{{ url_for('patient_form') }}" class="btn btn-primary btn-lg me-3">üîÑ –ù–æ–≤—ã–π –ø–æ–∏—Å–∫</a>
            <a href="{{ url_for('all_programs') }}" class="btn btn-outline-secondary btn-lg">üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ
                –ø—Ä–æ–≥—Ä–∞–º–º—ã</a>
        </div>
    </div>
</div>
{% endblock %}